## The *Check-MailobxSize3.ps1* PowerShell Script

Check-MailobxSize3.ps1 [[-VerboseLvl] <byte>] [<CommonParameters>]


## Parameters
```powershell


[<CommonParameters>]
    This script supports the common parameters: Verbose, Debug, ErrorAction, ErrorVariable, WarningAction,
    WarningVariable, OutBuffer, PipelineVariable, and OutVariable.
```

## Source Code
```powershell
<#
    .Synopsis
       Permet de se connecter au tenant via Microsoft Graph et de vérifier la taille actuelle de toutes les boîtes aux lettres du tenant et d'alerter un 
       administrateur en cas de dépassement d'un seuil.

    .DESCRIPTION
        Ce script PowerShell fait appel à l'API Microsoft Graph. Il permet de se connecter puis de récupérer la taille de toutes les boîtes Mail du Tenant.
        Il va vérifier que celles-ci ne dépassent pas un seuil, dans le cas contraire, un mail est envoyé pour alerter un Adminsitrateur avec la liste des
        utilisateurs qui dépasse le seuil. Il se déconnecte ensuite du tenant.

    .EXAMPLE
        .\Check-MailboxSize.ps1

    .EXAMPLE
        .\Check-MailboxSize.ps1 -VerboseLvl 1

    .INPUTS
        Un fichier JSON est necessaire pour fonctionner et se connecter au tenant.
        Ce fichier contient :
            - clientId          : Application (client) ID
            - clientCertificate : Le thundprint du certificat
            - tenantId          : Directory (tenant) ID
            - organisationName  : domaine.onmicrosoft.com

    .INPUTS Optionnal
        - VerboseLvl  : 0 par defaut
                [0 = Aucun ; 1 = Brief ; 2 = Tout], cette option permet de changer le niveau d'information affichée dans la console

    .OUTPUTS


    .NOTES
       N.A

    .FUNCTIONALITY
       N.A
#>


[cmdletbinding()]
Param (
    [ValidateSet(0,1,2)][System.Byte]$VerboseLvl = 0
)


#region Variables
    $Global:VerboseLvl = $VerboseLvl
    $Global:sTimestamp = Get-Date -F "yyyyMMdd_HHmmss"
    $Global:sRunScript = $($MyInvocation.MyCommand.Name).Split('.')[0]
    $Global:sRunPath = $PSScriptRoot
    $Global:sRunUser = $env:UserName
    $Global:sRunUserDomain = $env:UserDomain
    $Global:logFileDir = "$sRunPath\Logs"
    $Global:LogSource = "PowerShell-Script-Check_MailboxSize"

    $seuilMail = "1.2MB"

    $Periode = "D30"
    $CsvPath = $sRunPath
    $CsvFile = "Tmp-ReportMailboxUsageDetail-$Periode-$(Get-Date -Format 'yyyy_MM_dd-hh_mm_ss').csv"

    $destinataire = "laboitepubb@gmail.com"
#endregion Variables


#region functions

    Import-Module -Name $sRunPath\GeneriqueFunction.ps1 -Force

#endregion functions


#region Event message

$Message_Event_Error_GetStockage = # Event 2573
"   Utilisateur `t: $sRunUserDomain\$sRunUser
    Description `t: Impossible de récupérer le stockage utilisé par les utilisateurs
    Date `t`t`t: $(Get-Date)
    Information complementaire :`n`r
"
$Message_Event_Error_SupprCsv = # Event 2574
"   Utilisateur `t: $sRunUserDomain\$sRunUser
    Description `t: Impossible de supprimer le fichier CSV temporaire
    Date `t`t`t: $(Get-Date)
    Information complementaire :`n`r
"

#endregion Event message


#region main

    Clear-Host
    Log "Debut du script [$($MyInvocation.MyCommand.Name)] " $logFileDir 0 Magenta
    #Write-Host "param = $($PSBoundParameters.ContainsKey('VerboseLvl'))"
    $ErrorActionPreference = "Stop"

    ## Import du module Microsoft.Graph
    Import-MsGraph

    # Connexion au tenant
    Connect-MsGraphTenant

    # Verifie la taille des boites au lettre

        try {
            Log "Récuperation du stockage utilisé par les utilisateurs dans un fichier temporaire " $logFileDir 1 Cyan

    # Deconnexion du tenant
    Disconnect-MsGraphTenant
    Exit 0

#endregion Main
```

*Generated by convert-ps2md.ps1 using the comment-based help of Check-MailobxSize3.ps1*